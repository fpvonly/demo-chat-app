<!DOCTYPE html>
<html>
   <head>
	  <meta name="keywords" content="web, developer, node.js, expressjs">
	  <meta name="description" content="Web Developer - Ari Petäjäjärvi">
	  <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
	  <meta name="viewport" content="width=device-width, initial-scale=1">
	  <link rel="stylesheet" href="<%- domain %>/assets/css/styles.css">
	  <script src="<%- domain %>/assets/js/jquery-2.1.4.min.js"></script>
	  <script src="<%- domain %>/assets/js/chat_ws.js"></script>
	
	  <script type="text/javascript">
	  	   $( document ).ready( function() {	
	  	   			   		
				$('.main_link').click(function(e) {
					if( $(this).hasClass('ext') == false )
					{
						e.preventDefault();					

						$('.main_link').removeClass('main_link_active');
						$( this ).addClass('main_link_active' );						
						
						$('#page_load_content').clearQueue();						

						var action = $( this ).attr('data-target');
						var xhr = $.ajax({ 
							method: 'GET',
							url: '/dataload/'+action, 
							cache:false,
							success: function( result ) {
								$('#page_load_content').animate({opacity:0}, 0);
								$('#page_load_content').html( result );
								$('#page_load_content').css({'display':'block'});							
								$('#page_load_content').animate({opacity:1}, 1500);								
						}});
					}
				});
				
				$( 'img' ).removeAttr( 'width height' );			
				// init chat							
				$('#chat_form').chat();					



				//ADMIN

				if( window.FileReader) 
				{ 			
				    var client = new XMLHttpRequest();
		  
				    function upload( file ) 
				    {
					   var formData = new FormData();
					   formData.append("file", file);

					   client.open("POST", "/admin/upload", true);
					   client.send( formData ); 
				    }
					 
				    client.onreadystatechange = function() 
				    {
					   if (client.readyState == 4 && client.status == 200) 
					   {
						  //alert(client.statusText);
					   }
				    }
							
					
					var drop  = document.getElementById('hit');
					var list  = document.getElementById('upload_list');
					
					function cancel(e) {
					  if( e.preventDefault ) { e.preventDefault(); }
					  return false;
					}
					
					/*Function.prototype.bindToEventHandler = function bindToEventHandler() {
						  var handler = this;
						  var boundParameters = Array.prototype.slice.call(arguments);
						  //create closure
						  return function(e) {
							  e = e || window.event; // get window.event if e argument missing (in IE)   
							  boundParameters.unshift(e);
							  handler.apply(this, boundParameters);
						  }
					};*/
					
					// Tells the browser that we *can* drop on this target
					drop.addEventListener( 'dragover', cancel);
					drop.addEventListener( 'dragenter', cancel);
					drop.addEventListener( 'drop', function (e) {
					  e = e || window.event; // get window.event if e argument missing (in IE)   
					  if( e.preventDefault ) { e.preventDefault(); } // stops the browser from redirecting off to the image.

					  var dt  = e.dataTransfer;
					  var files = dt.files;
					  for( var i=0; i<files.length; i++ ) {
							var file = files[i];
							var reader = new FileReader();
							
							upload( file );
							
							reader.addEventListener('loadend', function(e) {
								var bin = this.result; 			
								var img = document.createElement("img"); 
								img.src = bin;
								list.appendChild(img);
							});
							//}.bindToEventHandler( file ));
											   
							reader.readAsDataURL( file );
					  }
					  return false;
					});
				 
				} 
				else 
				{ 
				  document.getElementById('drop').innerHTML = 'Your browser does not support the HTML5 FileReader.';
				}
		   });  
		   
		   function isValidEmailAddress( emailAddress ) {
				var pattern = new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);
				return pattern.test( emailAddress );
			};
	  </script>
	</head>
	<body>
	
		<header class="full_header">
			<div class="wrapper_navi">
				<div class="main_logo">
					<a href="<%- domain %>">
						<img src="<%- domain %>/assets/images/logo.png" alt="Web developer - Ari Petäjäjärvi" />						
					</a>				
				</div>
				<nav id="navigation">
					
				</nav>
				<%
				if( typeof type != 'undefined' && type == 'admin' && typeof auth_obj.user_id != 'undefined' && auth_obj.user_id > 0 )
				{
				%>
					<div id="login_fields">
						<span class="welcome_text">
							<%- 'Welcome '+auth_obj.username + '<br />' %>
						</span>
						<a href="<%- domain %>/admin/logout" target="_self">Log out</a>
					</div>
				<%
				} 
				else if( typeof type != 'undefined' && type == 'admin' ) { %>
					<div id="login_fields">
						<form action="<%- domain %>/admin/login" type="application/x-www-form-urlencoded" method="POST">
							<input type="text" name="admin_username" placeholder="Username" value="<%= username %>" />
							<input type="password" name="admin_password" placeholder="Password" value="<%= password %>" />
							<input type="submit" name="log_in_btn" id="log_in_btn" value="Login" />
						</form>
					</div>
				<% } %>
				<div class="clear"></div>
			</div>
		</header>
   
		<section class="parallax-window parallax">
			<div class="parallax_content">
				<% if( typeof auth_obj.user_id != 'undefined' && auth_obj.user_id > 0 ) { %>
				<div id="admin_page_load_content">
					<div id="drop_area_wrapper">
						<div id="hit">Drop files here for quick upload</div>
						<div id="upload_list"></div>
					</div>
				</div>
				<% } %>
				
				<p class="info"><%- index_chat_text %></p>
				
				<div id="chat_area">	 		
				 <form id="chat_form" action="#" method="POST" enctype="application/x-www-form-urlencoded">
					<div id="chat_reg">
						<input type="text" name="chat_name" id="chat_name" placeholder="Chat name"  maxlength="20"/>
						<input type="text" name="email" id="email" placeholder="E-mail" maxlength="40" />				
						<input type="button" value="Log in" id="reg_btn" />
					</div>			
					<div id="chat_funcs" style="display:none;">
						<input type="text" name="message_input" id="message_input" maxlength="1000" placeholder="Message"/>
						<input type="button" value="Send" id="message_send_btn" />
					</div>
					<div id="message_area"> 
						<div class="clear"></div>
					</div>					
				 </form>
			  </div>  
			</div>		
			<div class="footer_content"><%= footer_text %></div>
		
		</section>	   
   </body>
</html>